---
import BaseLayout from '@layouts/BaseLayout.astro';
import { withBase, withBaseIfAbsolute } from '@lib/paths';
import TagChip from '@atoms/TagChip.astro';
interface Props {
  title: string;
  description?: string;
  hero?: string;
  pubDate: string | Date;
  tags?: string[];
}
const { title, description, hero, pubDate, tags = [] } = Astro.props;
const date = new Date(pubDate);
const site = Astro.site?.toString() ?? 'http://localhost:4321/';
const cleanPath = Astro.url.pathname.replace(/^\//, '');
const canonical = new URL(withBase(cleanPath), site).toString();
const ogImage = hero ? new URL(withBaseIfAbsolute(hero)!, site).toString() : undefined;
---
<BaseLayout title={title} description={description} ogType="article" ogImage={ogImage} canonical={canonical}>
  <article>
    {hero && <img class="hero-img" src={withBaseIfAbsolute(hero)} alt="" loading="lazy" />}
    <h1>{title}</h1>
    <p class="post-meta">
      <time datetime={date.toISOString()}>{date.toLocaleDateString('ja-JP')}</time>
      {tags.length > 0 && (
        <span> Â· {tags.map((t) => <TagChip href={withBase(`tags/${t.toLowerCase().replace(/\s+/g,'-')}/`)} label={t} />)}</span>
      )}
    </p>
    <slot />
  </article>
</BaseLayout>

<style>
.hero-img { border-radius:8px; margin-bottom:1rem; }
.post-meta { color:var(--muted); font-size:0.95rem; }
</style>
